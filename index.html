<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–°–í–û–Ø –ö–£–•–ù–Ø ‚Äî –¥–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=PT+Sans+Narrow:700&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand-olive:#556B2F;
      --brand-olive-light:#7B8A2F;
      --bg-cream:#f7efe0;
      --accent:#b3611f;
      --muted:#7c6a5c;
      --card-border:#6b7a29;
    }
    html,body{height:100%;}
    body {
      background: var(--bg-cream);
      font-family: 'PT Sans Narrow', Arial, sans-serif;
      margin:0;
      min-height:100vh;
      color:#2b2b2b;
    }
    .header {
      text-align:center;
      padding:28px 12px 10px 12px;
      background: linear-gradient(90deg, var(--brand-olive) 0%, var(--brand-olive-light) 100%);
      box-shadow:0 2px 10px rgba(0,0,0,0.08);
      position:relative;
    }
    .logo-wrap {
      display:flex;
      align-items:center;
      justify-content:center;
      gap:14px;
      flex-wrap:wrap;
    }
    @keyframes logoPop { from{transform:scale(0.7); opacity:0;} to{transform:scale(1); opacity:1;} }
    .logo-img {
      width:84px;
      height:84px;
      object-fit:cover;
      border-radius:50%;
      border: none;
      background: transparent;
      padding: 0;
      box-shadow:0 6px 18px rgba(0,0,0,0.12);
      animation:logoPop .35s ease;
    }
    .header-title {
      font-size:2.0em;
      color:#fff;
      font-weight:800;
      letter-spacing:1px;
      text-shadow:0 1px 6px rgba(0,0,0,0.12);
      margin-bottom:0;
    }
    .header-desc {
      color:#fffbe6;
      font-size:1.02em;
      font-weight:700;
      letter-spacing:0.5px;
      margin-top:6px;
      opacity:0.95;
    }
    .promo-banner {
      text-align:center;
      margin-top:10px;
      margin-bottom:10px;
      letter-spacing:1px;
    }
    .promo-star { color:var(--accent); font-size:1.6em; vertical-align:middle; }
    .promo-text { color:#fffbe6; font-weight:700; margin:0 8px; }
    .menu {
      display:flex; flex-wrap:wrap; gap:18px; justify-content:center; margin:26px 12px 80px 12px;
    }
    .product {
      background: #fff;
      border-radius:14px;
      box-shadow:0 4px 18px rgba(0,0,0,0.06);
      width:200px;
      padding:16px 12px 14px;
      display:flex; flex-direction:column; align-items:center;
      transition:transform .18s,box-shadow .18s;
      position:relative;
      border:2px solid var(--card-border);
      font-family: 'PT Sans Narrow', Arial, sans-serif;
    }
    .product:not(.unavailable):hover {
      transform:translateY(-6px) scale(1.02);
      box-shadow:0 10px 28px rgba(0,0,0,0.08);
      border-color:var(--brand-olive-light);
    }
    .product.unavailable { opacity:.6; pointer-events:none; }
    .product-img {
      width:100px; height:100px; object-fit:cover; border-radius:12px; margin-bottom:10px; background:#eee;
      border:2px solid var(--brand-olive);
    }
    .product-name {
      font-size:1.05em; font-weight:700; color:var(--brand-olive); margin-bottom:6px; text-align:center;
      letter-spacing:1px; text-transform:uppercase;
    }
    .product-desc {
      color:var(--muted); font-size:.95em; margin-bottom:6px; text-align:center; min-height:36px;
    }
    .product-price {
      font-size:1.05em; color:#222; margin-bottom:10px; font-weight:700; letter-spacing:0.5px;
    }
    .controls { display:flex; align-items:center; gap:8px; }
    .add-btn, .remove-btn {
      border:none; border-radius:8px; font-size:1em; padding:6px 12px; margin:0 4px; cursor:pointer; transition:filter .12s;
      font-family: 'PT Sans Narrow', Arial, sans-serif;
      font-weight:700;
    }
    .add-btn { background:var(--brand-olive); color:#fff; box-shadow:0 2px 6px rgba(91,104,44,0.12); }
    .remove-btn { background:#fff; color:var(--brand-olive); border:1px solid var(--card-border); }
    .add-btn:active,.remove-btn:active{ transform:translateY(1px); }
    .cart-fab {
      position:fixed; bottom:22px; right:18px; background:none; border:none; box-shadow:none;
      width:72px; height:72px; display:flex; align-items:center; justify-content:center;
      cursor:pointer; z-index:100; padding:0;
      transition:transform .18s;
    }
    .cart-fab svg { display:block; filter: drop-shadow(0 4px 18px rgba(0,0,0,0.12));}
    .cart-fab-circle { fill:var(--accent); stroke:#fff; stroke-width:2; }
    .cart-fab-count {
      position:absolute; right:6px; top:6px; background:#fff; color:var(--accent); font-weight:700;
      border-radius:50%; min-width:26px; height:26px; display:flex; align-items:center; justify-content:center;
      font-size:1em; box-shadow:0 2px 8px rgba(0,0,0,0.12); border:2px solid var(--accent);
      pointer-events:none;
    }
    .cart-modal-bg {
      position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.35); z-index:200;
      display:flex; align-items:flex-start; justify-content:center; animation:fadein .22s;
    }
    @keyframes fadein { from{opacity:0;} to{opacity:1;} }
    .cart-modal {
      background: var(--bg-cream); border-radius:18px; padding:20px 16px 16px 16px; min-width:320px; max-width:95vw;
      box-shadow:0 12px 36px rgba(0,0,0,0.12); position:relative;
      border:2px solid var(--brand-olive);
      font-family: 'PT Sans Narrow', Arial, sans-serif;
      max-height:86vh; overflow-y:auto;
      display:flex; flex-direction:column;
      margin-top:36px;
    }
    .cart-title { font-size:1.2em; color:var(--brand-olive); margin-bottom:10px; letter-spacing:1px; font-weight:800; }
    .cart-list { list-style:none; padding:0; margin:0 0 10px 0; }
    .cart-list li { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; color:#333; }
    .cart-total { font-size:1.05em; color:#222; margin-bottom:12px; text-align:right; font-weight:800; }
    .cart-close { position:absolute; right:10px; top:8px; font-size:1.4em; color:var(--brand-olive); background:none; border:none; cursor:pointer; }
    .order-form input, .order-form textarea, .order-form select {
      width:100%; padding:8px; margin-bottom:8px; border-radius:8px; border:1px solid #ddd; font-size:1em;
      background:#fff; font-family: 'PT Sans Narrow', Arial, sans-serif;
    }
    .order-btn {
      background:var(--accent); color:#fff; border:none; border-radius:8px; padding:10px 18px; font-size:1.03em; font-weight:800; cursor:pointer; width:100%; margin-top:8px;
      letter-spacing:1px;
    }
    .order-success { color:#2e7d32; font-size:1.05em; text-align:center; margin-top:10px; }
    .unavailable-label {
      position:absolute; left:0; top:0; right:0; background:var(--accent); color:#fff; font-size:.95em; border-radius:14px 14px 0 0; padding:4px 0; text-align:center; letter-spacing:1px;
    }
    @media (max-width:600px) {
      .menu { gap:10px; }
      .product { width:44vw; min-width:120px; padding:10px 8px; }
      .product-img { width:64px; height:64px; }
      .cart-modal { min-width:92vw; padding:12px 8px 10px 8px; border-radius:16px; margin-top:12vw;}
      .cart-fab { width:56px; height:56px; bottom:12px; right:10px; top:auto !important;}
      .cart-fab-count { min-width:18px; height:18px; font-size:.9em; right:2px; top:2px; }
      .header-title { font-size:1.4em; }

      /* Mobile layout tweaks */
      .logo-wrap { flex-direction: column; gap:8px; }
      .header-desc { font-size:0.95em; }
      .promo-text { display:block; font-size:0.95em; margin:4px 0; }

      /* Controls stack/wrap on mobile to avoid single-row overflow */
      .controls {
        display:flex;
        flex-wrap:wrap;
        justify-content:center;
        gap:6px;
      }
      .add-btn, .remove-btn { padding:6px 8px; font-size:0.95em; }
      .product-name { font-size:1em; }
      .product-desc { min-height:28px; font-size:0.9em; }
      .product-price { font-size:0.98em; }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo-wrap">
      <!-- –ü–æ–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª logo.png —Ä—è–¥–æ–º —Å —ç—Ç–∏–º HTML, –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç–µ src –Ω–∞ URL.
           –î–ª—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–≥–æ —Ñ–æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ PNG/SVG —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é. -->
      <img class="logo-img" src="logo.png" alt="–°–í–û–Ø –ö–£–•–ù–Ø">
      <div>
        <div class="header-title">–°–í–û–Ø –ö–£–•–ù–Ø</div>
        <div class="header-desc">–î–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã ‚Äî –≤–∫—É—Å–Ω–æ, –±—ã—Å—Ç—Ä–æ, —Ä—è–¥–æ–º</div>
      </div>
    </div>
    <div class="promo-banner">
      <span class="promo-star">‚òÖ</span>
      <span class="promo-text">–ì–æ—Ä—è—á–∏–µ –±–ª—é–¥–∞ –∑–∞ 30‚Äì45 –º–∏–Ω</span>
      <span class="promo-star">‚òÖ</span>
    </div>
  </div>

  <div class="menu" id="menu"></div>

  <button id="cartFab" class="cart-fab" style="display:none;" title="–ö–æ—Ä–∑–∏–Ω–∞">
    <svg viewBox="0 0 48 48" width="56" height="56" style="display:block;margin:auto;">
      <circle cx="24" cy="24" r="22" class="cart-fab-circle"/>
      <path d="M16 18h16l-2 13a3 3 0 0 1-3 2h-6a3 3 0 0 1-3-2l-2-13zm3 0v-4a3 3 0 0 1 3-3h2a3 3 0 0 1 3 3v4" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round"/>
      <circle cx="19" cy="36" r="2" fill="#fff"/>
      <circle cx="29" cy="36" r="2" fill="#fff"/>
    </svg>
    <span id="cartFabCount" class="cart-fab-count"></span>
  </button>

  <div id="cartModalBg" style="display:none;"></div>

  <script>
    // --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ---
    const SHEET_API_URL = 'https://script.google.com/macros/s/AKfycbxu0lkODTN7jGBCqYbsNA0-njTGFfzqQ878N4iDW2w-VW6-fScQf0ku2PAtxxq_c3lN/exec';
    const TELEGRAM_BOT_TOKEN = '7253551384:AAGg18hGzmFAL1tVGIbqapy43wFtA0xwivc';
    const TELEGRAM_CHAT_ID = '7567253745';

    let menuData = [];
    let cart = {};

    // --- –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–Ω—é (—É—Å—Ç–æ–π—á–∏–≤—ã–π –ø–∞—Ä—Å–µ—Ä) ---
    async function loadMenu() {
      try {
        const res = await fetch(SHEET_API_URL);
        if (!res.ok) throw new Error('Network response not OK: ' + res.status);
        let data = await res.json();
        if (data && data.menu) data = data.menu;

        // case: array of arrays (headers + rows)
        if (Array.isArray(data) && data.length > 0 && Array.isArray(data[0])) {
          const headers = data[0].map(h => String(h || '').trim().toLowerCase());
          const rows = data.slice(1);
          data = rows.map(row => {
            const obj = {};
            headers.forEach((h, i) => obj[h] = row[i]);
            return obj;
          });
        }

        // normalize item keys and parse price
        function normalizeItem(it) {
          const out = {};
          Object.keys(it || {}).forEach(k => {
            const key = String(k || '').trim().toLowerCase();
            const val = it[k];
            if (key === 'price' || key.includes('price')) {
              // remove non-numeric except comma/dot/minus, replace comma with dot
              const s = String(val ?? '').replace(/[^\d,.\-]/g, '').replace(/\s+/g, '').replace(',', '.');
              out.price = Number(s) || 0;
            } else if (key === 'available' || key.includes('available')) {
              const v = String(val ?? '').trim().toLowerCase();
              out.available = v === 'true' || v === '1' || v === 'yes';
            } else if (key === 'img' || key === 'image' || key.includes('img')) {
              out.img = val;
            } else if (key === 'name' || key === 'title') {
              out.name = val;
            } else if (key === 'description' || key === 'desc') {
              out.description = val;
            } else {
              out[key] = val;
            }
          });
          // defaults
          if (out.price == null) out.price = 0;
          if (out.available == null) out.available = true;
          if (!out.name) out.name = '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
          return out;
        }

        menuData = (data || []).map((item, idx) => ({ ...normalizeItem(item), id: idx + 1 }));
        renderMenu();
      } catch (e) {
        console.error('loadMenu error', e);
        document.getElementById('menu').innerHTML =
          '<div style="color:var(--brand-olive);font-size:1.1em;text-align:center;margin:40px auto;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–Ω—é. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–ª–∏ API Google Sheets. –°–º–æ—Ç—Ä–∏—Ç–µ –∫–æ–Ω—Å–æ–ª—å.</div>';
      }
    }

    // --- –†–µ–Ω–¥–µ—Ä –º–µ–Ω—é ---
    function renderMenu() {
      const menu = document.getElementById('menu');
      menu.innerHTML = '';
      menuData.forEach(item => {
        const prod = document.createElement('div');
        prod.className = 'product' + (!item.available ? ' unavailable' : '');
        const priceText = (Number(item.price) || 0).toLocaleString('vi-VN') + ' ‚Ç´';
        prod.innerHTML = `
          ${!item.available ? `<div class="unavailable-label">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</div>` : ''}
          <img class="product-img" src="${item.img || ''}" alt="${item.name}">
          <div class="product-name">${item.name}</div>
          <div class="product-desc">${item.description || ''}</div>
          <div class="product-price">${priceText}</div>
          <div class="controls">
            <button class="remove-btn" ${!item.available ? 'disabled' : ''} onclick="updateCart(${item.id},-1)">‚àí</button>
            <span id="qty-${item.id}">${cart[item.id]?.qty||0}</span>
            <button class="add-btn" ${!item.available ? 'disabled' : ''} onclick="updateCart(${item.id},1)">+</button>
          </div>
        `;
        menu.appendChild(prod);
      });
      updateCartFab();
    }

    // --- –ö–æ—Ä–∑–∏–Ω–∞ ---
    window.updateCart = function(id, delta) {
      const item = menuData.find(i => i.id === id);
      if (!item || !item.available) return;
      if (!cart[id]) cart[id] = { ...item, qty: 0 };
      cart[id].qty = Math.max(0, cart[id].qty + delta);
      if (cart[id].qty === 0) delete cart[id];
      const qtyEl = document.getElementById(`qty-${id}`);
      if (qtyEl) qtyEl.textContent = cart[id]?.qty || 0;
      updateCartFab();
      if (document.getElementById('cartModalBg').style.display === 'flex') showCartModal();
    };

    function updateCartFab() {
      const fab = document.getElementById('cartFab');
      const count = Object.values(cart).reduce((s, i) => s + i.qty, 0);
      if (count > 0) {
        fab.style.display = 'flex';
        document.getElementById('cartFabCount').textContent = count;
      } else {
        fab.style.display = 'none';
        document.getElementById('cartFabCount').textContent = '';
      }
    }

    document.getElementById('cartFab').onclick = showCartModal;

    function showCartModal() {
      const modalBg = document.getElementById('cartModalBg');
      const items = Object.values(cart);
      modalBg.innerHTML = `
        <div class="cart-modal">
          <button class="cart-close" onclick="closeCartModal()">&times;</button>
          <div class="cart-title">–ö–æ—Ä–∑–∏–Ω–∞</div>
          <ul class="cart-list">
            ${items.length === 0 ? '<li style="color:var(--brand-olive);text-align:center;width:100%;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</li>' : items.map(item => `
              <li>
                <span>${item.name} x${item.qty}</span>
                <span>
                  <button class="remove-btn" onclick="updateCart(${item.id},-1)">‚àí</button>
                  <span style="margin:0 8px;">${(item.price * item.qty).toLocaleString('vi-VN')} ‚Ç´</span>
                  <button class="add-btn" onclick="updateCart(${item.id},1)">+</button>
                </span>
              </li>
            `).join('')}
          </ul>
          <div class="cart-total">–ò—Ç–æ–≥–æ: ${items.reduce((s,i)=>s + i.price * i.qty, 0).toLocaleString('vi-VN')} ‚Ç´</div>
          <form class="order-form" id="orderForm">
            <input type="text" id="name" placeholder="–ò–º—è –∏–ª–∏ –Ω–∏–∫ –≤ Telegram" required>
            <input type="tel" id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" required>
            <input type="text" id="address" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏" required>
            <select id="payment">
              <option value="">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</option>
              <option value="cash">–ù–∞–ª–∏—á–Ω—ã–µ</option>
              <option value="card">–ö–∞—Ä—Ç–∞</option>
            </select>
            <textarea id="comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" rows="2"></textarea>
            <button type="submit" class="order-btn">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
            <div id="orderSuccess" class="order-success" style="display:none;"></div>
          </form>
        </div>
      `;
      modalBg.style.display = 'flex';
      document.getElementById('orderForm').onsubmit = sendOrder;
      setTimeout(() => {
        const modal = document.querySelector('.cart-modal');
        if (modal) modal.scrollIntoView({behavior: "smooth", block: "start"});
      }, 50);
    }
    window.closeCartModal = function() {
      document.getElementById('cartModalBg').style.display = 'none';
    };

    // --- –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞ ---
    async function sendOrder(e) {
      e.preventDefault();
      const btn = document.querySelector('.order-btn');
      btn.disabled = true;
      btn.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
      const name = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const address = document.getElementById('address').value.trim();
      const payment = document.getElementById('payment').value;
      const comment = document.getElementById('comment').value.trim();
      if (!name || !phone || !address) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
        btn.disabled = false; btn.textContent = '–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑'; return;
      }
      const itemsArr = Object.values(cart);
      const total = itemsArr.reduce((s,i)=>s + i.price * i.qty, 0);
      let orderLines = itemsArr.map(i => `${i.name} x${i.qty} ‚Äî ${(i.price * i.qty).toLocaleString('vi-VN')} ‚Ç´`).join('\n');
      let paymentText = payment === 'cash' ? '–û–ø–ª–∞—Ç–∞: –ù–∞–ª–∏—á–Ω—ã–µ' : payment === 'card' ? '–û–ø–ª–∞—Ç–∞: –ö–∞—Ä—Ç–∞' : '';
      const text =
        `üõí –ù–æ–≤—ã–π –∑–∞–∫–∞–∑ (–°–í–û–Ø –ö–£–•–ù–Ø)\n` +
        `–ò–º—è/–Ω–∏–∫: ${name}\n–¢–µ–ª–µ—Ñ–æ–Ω: ${phone}\n–ê–¥—Ä–µ—Å: ${address}\n` +
        (paymentText ? paymentText + '\n' : '') +
        (comment ? `–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${comment}\n` : '') +
        `\n–ó–∞–∫–∞–∑:\n${orderLines}\n\n–°—É–º–º–∞: ${total.toLocaleString('vi-VN')} ‚Ç´`;
      try {
        const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text })
        });
        const result = await response.json();
        if (result.ok) {
          btn.style.display = 'none';
          document.getElementById('orderSuccess').style.display = 'block';
          document.getElementById('orderSuccess').textContent = '–°–ø–∞—Å–∏–±–æ! –í–∞—à–∞ –∑–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞.';
          cart = {};
          setTimeout(()=>{ closeCartModal(); renderMenu(); }, 1500);
        } else {
          alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–∫–∞–∑–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
          btn.disabled = false; btn.textContent = '–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑';
          console.error('telegram sendMessage failed', result);
        }
